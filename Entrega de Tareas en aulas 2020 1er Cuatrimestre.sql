select c.id as course_id, c.shortname as course_shortname,
    a.name as assign_name, cm.id as module_id,
    count (sub.userid) as submissions,
    (
        SELECT
        COUNT(distinct asg.userid) AS "Estudiantes"
    FROM
        mdl_role_assignments AS asg
        JOIN mdl_context AS context ON asg.contextid = context.id
            AND context.contextlevel = 50
        JOIN mdl_course AS course ON context.instanceid = course.id
        JOIN mdl_role as r ON asg.roleid = r.id
    WHERE
            r.shortname like 'student'
        and course.id=c.id
    )
from mdl_assign_submission as sub
    inner join (select *
    from mdl_course_modules
    where module=1 and deletioninprogress=0) as cm
    inner join mdl_course as c on cm.course=c.id
    inner join mdl_assign as a on cm.instance=a.id on sub.assignment=cm.instance
    inner join mdl_user as u on sub.userid=u.id
where c.id in (1783,1810,1784,1811,2356,2357,2358,2359,2360,2361,1098,1107,1108,1109,1099,
1100,1101,1102,1103,1104,1105,1106,1110,1111,1112,1113,1114,1115,1116,1117,1118,1119,1120,
1121,1122,1308,1309,1310,1311,1312,1313,1314,1178,1315,1316,1317,1283,1676,1259,1258,1217,
1181,1257,1256,1677,1678,1679,1262,1490,1488,1491,1489,1492,1284,1680,1681,1188,1497,1498,
2021,1682,1683,1684,1685,1686,1687,1688,1168,1838,1689,1690,1472,2309,1691,1692,1785,1693,
1303,2166,1694,1695,1285,1304,1696,1286,1287,1594,1299,678,1595,1596,1807,1610,1611,1808,
1781,1612,1613,1198,1847,1603,1604,1606,1809,679,1804,1597,1598,1599,1600,1805,1779,1601,
1602,1605,1806,1741,1742,1743,1744,1745,1746,1747,1748,1749,1750,1751,1752,1792,1793,1794,
1795,1220,1753,1754,1755,1756,1757,1222,1796,1797,1798,1249,1799,1301,1758,1759,1229,1800,
1801,1802,1803,1223,1760,1176,1761,1762,1763,1764,1765,1703,1704,1250,1255,1154,1322,1319,
1251,1706,1289,1321,1202,1320,1266,1773,1555,1267,1823,1169,1826,1827,1828,1829,1830,1831,
1832,1473,1268,1474,1476,1477,1556,2329,2330,1558,1269,1774,1559,2344,2345,2346,2347,2348,
2349,1561,2350,2352,2351,1563,1564,1565,1566,1270,1775,2320,2321,1568,1569,1570,1571,1572,
1573,1574,1271,1575,1776,1576,2317,2318,2319,1577,1578,1579,1839,1581,1582,1583,1584,1585,
1777,1778,1586,1587,1588,1589,1590,1591,1592,1593,2322,2324,1708,1548,1545,1294,1711,1712,
1713,1714,1715,1273,1272,1716,1717,1293,1837,1718,1786,1719,1193,1550,1551,1721,2314,2315,
2316,2311,2312,2313,1724,1787,1788,1725,1726,1478,1296,1727,1728,1789,1790,1729,1730,1731,
1732,1184,1182,1733,1734,1297,1190,1814,1791,2341,2339,1736,1500,1737,1738,1739,1740,1671,
1672,1673,1674,1675,1241,1240,1242,1243,1244,1245,1246,1247,1226,1248,2337,2338,1542,1767,
2323,1479,1621,1813,1622,1623,1496,1625,1626,1172,1634,1640,1641,1642,1275,1643,1644,1645,
1487,1276,1277,1646,1156,1278,1647,1648,1326,1279,1650,1203,1280,1651,1652,1653,1654,1157,
1655,1658,1282,1231,1233,1232,1234,1235,1236,1237,1153,1239,1537,1194,1543,1205,1484,1300,
1230,1195,1702,1324,1291,1264,1196,1329,1227,1292,1161,1656,1200,1265,1307,1657,1659,1660,
1661,1662,1159,1664,1665,1666,1667,1668,1669,1670,1628,1630,1631,1632,1633,1635,1165,1162,
1638,1540) and sub.status like 'submitted'
group by c.id, c.shortname, a.name, cm.id
order by c.shortname, a.name
